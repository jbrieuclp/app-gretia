<h4> Listing des études </h4>

<div class="row">
  <div class="col-sm-11">
    <button 
      mat-fab 
      class="float-left"
      color="primary" 
      matTooltip="Filtres complémentaires"
      (click)="collapsed = !collapsed"
    >
      <mat-icon>filter_alt</mat-icon>
    </button>
    <div class="row">
      <mat-form-field class="col-sm-6">
        <mat-icon matPrefix>search</mat-icon>
        <input 
          matInput
          placeholder="Rechercher..." 
          [formControl]="filterInput">
        <mat-icon 
          matSuffix
          (click)="filterInput.setValue('')"
        >clear</mat-icon>
      </mat-form-field>
    </div>
    <div 
      class="collapsible" 
      [@collapse]="collapsed"
    >
      Collapse

    </div>
  </div>


  <div class="float-right">
    <a 
      [routerLink]="['./form']"
      type="button"
      mat-fab 
      color="primary"
      matTooltip="Déposer une nouvelle étude"
    >
      <mat-icon>add</mat-icon>
    </a>
  </div>
</div>

<div class="list-container mat-elevation-z8">
  <div 
    *ngIf="loading"
    class="loading-shade"
  >
    <mat-spinner></mat-spinner>
  </div>

  <div class="table-container">
    <table 
      mat-table 
      [dataSource]="dataSource" 
      matSort
      class="mat-elevation-z8">

      <!--- Note that these columns can be defined in any order.
            The actual rendered columns are set as a property on the row definition" -->

      <ng-container matColumnDef="study.code">
        <th 
          mat-header-cell 
          *matHeaderCellDef 
          mat-sort-header
        > Code </th>
        <td mat-cell *matCellDef="let row"> {{ row.study.code }} </td>
      </ng-container>

      <!-- Name Column -->
      <ng-container matColumnDef="study.label">
        <th 
          mat-header-cell 
          *matHeaderCellDef 
          mat-sort-header
        > Intitulé </th>
        <td mat-cell *matCellDef="let row"> 
        	<a [routerLink]="[row.study.id]" 
        		matTooltip="Ouvrir le study {{ row.study.label }}"
        	><b>{{ row.study.label }}</b></a>
        </td>
      </ng-container>

      <!-- Name Column -->
      <ng-container matColumnDef="locals">
        <th 
          mat-header-cell 
          *matHeaderCellDef 
          mat-sort-header
        > Local </th>
        <td mat-cell *matCellDef="let row"> 
          {{ row.locals.length ? row.locals.joins(', ') : ' - ' }}
        </td>
      </ng-container>

      <!-- Weight Column -->
      <ng-container matColumnDef="dateStart">
        <th 
          mat-header-cell 
          *matHeaderCellDef 
          mat-sort-header
        > Commencement </th>
        <td mat-cell *matCellDef="let row"> {{ row.dateStart }} </td>
      </ng-container>

      <!-- Weight Column -->
      <ng-container matColumnDef="dateEnd">
        <th 
          mat-header-cell 
          *matHeaderCellDef 
          mat-sort-header
        > Fin </th>
        <td mat-cell *matCellDef="let row"> {{ row.dateEnd }} </td>
      </ng-container>

      <!-- Name Column -->
      <ng-container matColumnDef="nbOfDays">
        <th 
          mat-header-cell 
          *matHeaderCellDef 
          mat-sort-header
        > Nombre de jours </th>
        <td mat-cell *matCellDef="let row"> 
          {{ row.nbOfDays }}
        </td>
      </ng-container>

      <!-- Name Column -->
      <ng-container matColumnDef="consumedTime">
        <th 
          mat-header-cell 
          *matHeaderCellDef 
          mat-sort-header
        > Jours conso. </th>
        <td mat-cell *matCellDef="let row"> 
          {{ row.consumedTime }}
        </td>
      </ng-container>

      <!-- Name Column -->
      <ng-container matColumnDef="usagePercent">
        <th 
          mat-header-cell 
          *matHeaderCellDef 
          mat-sort-header
        > Jours conso (%) </th>
        <td mat-cell *matCellDef="let row"> 
          {{ row.usagePercent }}
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
      
    </table>

    <mat-paginator 
      [length]="resultsLength" 
      [pageSize]="25"
      [pageSizeOptions]="[10, 25, 50, 100, 250]"
    ></mat-paginator>
  </div>
</div>