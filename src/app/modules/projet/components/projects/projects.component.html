<mat-card>
	<mat-card-title>Liste des projets et des études associées</mat-card-title>
	<mat-card-content>
		<div style="margin-bottom: 20px;">
      <button 
        mat-raised-button 
        color="primary"
        [matMenuTriggerFor]="menu"
      ><mat-icon>add</mat-icon> Ajouter</button>
      <mat-menu #menu="matMenu">
        <button 
          mat-menu-item
          (click)="openProjectFormDialog()"
        >Projet</button>
        <button 
          mat-menu-item
          color="primary"
          (click)="openStudyFormDialog()"
        >Étude</button>
      </mat-menu>
    </div> 

		<ng-container *ngIf="!loadingList; else loadingTemplate">
			<!-- <table class="table table-bordered">
				<thead>
					<tr>
						<th>intitulé</th>
						<th></th>
					</tr>
				</thead>
				<tbody>
					<ng-container *ngIf="(projects||[]).length; else noData">
						<tr *ngFor="let project of projects">
							<td> <a routerLink="{{ project.id }}" title="Afficher les détails">{{ project.label }}</a> </td>
							<td>  </td>
						</tr>
					</ng-container>
					<ng-template #noData>
						<tr><td colspan="3">Aucune project enregistrée</td></tr>
					</ng-template>
				</tbody>
			</table> -->
			<table  
				mat-table
				[dataSource]="dataSource" 
				matSort
				multiTemplateDataRows
				class="mat-elevation-z8"
			>

				<ng-container matColumnDef="searcher">
	        <th mat-header-cell *matHeaderCellDef colspan="6">
	          <mat-form-field style="width: 50%;">
	            <input matInput 
	              placeholder="Rechercher..." 
	              [formControl]="filterInput">
	          </mat-form-field>
	        </th>
	      </ng-container>

			  <ng-container matColumnDef="projectType">
	        <th mat-header-cell *matHeaderCellDef mat-sort-header> Type </th>
	        <td mat-cell *matCellDef="let element"> {{ element.projectType?.code || '' }} </td>
	      </ng-container>

	      <!-- Label -->
	      <ng-container matColumnDef="label">
	        <th mat-header-cell *matHeaderCellDef mat-sort-header> Intitulé </th>
	        <td mat-cell *matCellDef="let element"> 
	        	<b>{{ element.label }}</b>
	        </td>
	      </ng-container>

	      <!-- Antenne -->
	      <ng-container matColumnDef="localAttachment">
	        <th mat-header-cell *matHeaderCellDef mat-sort-header> Antenne </th>
	        <td mat-cell *matCellDef="let element"> {{ element.localAttachment.name || '' }} </td>
	      </ng-container>

	      <!-- DateStart -->
	      <ng-container matColumnDef="dateStart">
	        <th mat-header-cell *matHeaderCellDef mat-sort-header> Début </th>
	        <td mat-cell *matCellDef="let element"> {{ element.dateStart | date:'dd/MM/y' }} </td>
	      </ng-container>

	      <!-- DateEnd -->
	      <ng-container matColumnDef="dateEnd">
	        <th mat-header-cell *matHeaderCellDef mat-sort-header> Fin </th>
	        <td mat-cell *matCellDef="let element"> {{ element.dateEnd | date:'dd/MM/y' }} </td>
	      </ng-container>

	      <!-- Access -->
	      <ng-container matColumnDef="access">
	        <th mat-header-cell *matHeaderCellDef>  </th>
	        <td mat-cell *matCellDef="let element"> 
	        	<a 
	        		mat-icon-button 
	        		[routerLink]="element.id"
	        		color="primary"
	        	>
					    <mat-icon>arrow_forward_ios</mat-icon>
					  </a>
	    		</td>
	      </ng-container>

			  <!-- Expanded Content Column - The detail row is made up of this one column that spans across all columns -->
			  <ng-container matColumnDef="expandedDetail">
			    <td mat-cell *matCellDef="let element" [attr.colspan]="columnsToDisplay.length">
			      <div 
			      	[className]="element == expandedElement ? 'example-element-detail expanded' : 'example-element-detail collapsed'"
			        [@detailExpand]="element == expandedElement ? 'expanded' : 'collapsed'">

			        <div class="description">
			        	<h6>Description</h6>
			        	<div [innerHTML]="element.description"></div>
			        </div>

							<table class="table">
								<thead>
									<tr>
										<th>Études financées</th>
										<th>Temps prévu</th>
										<th>Temps consommé</th>
									</tr>
								</thead>
								<tbody>
									<tr *ngFor="let study of element.studiesFundings">
										<td>
											<a 
												[routerLink]="['/projet/etudes/', study.id]" 
						        		matTooltip="Accéder au détail de l'étude"
						        	><b>{{ study.label }}</b></a>
										</td>
										<td>{{ study.daysSold }}</td>
										<td>{{ study.totalWorkedTime }}</td>
									</tr>
									<tr *ngIf="element.studiesFundings.length === 0">
										<td colspan="3">Aucune étude financée par ce projet</td>
									</tr>
								</tbody>
							</table>
						</div>
			    </td>
			  </ng-container>

			  <tr mat-header-row *matHeaderRowDef="columnsToDisplay"></tr>
			  <tr mat-header-row *matHeaderRowDef="['searcher']"></tr>
			  <tr 
			  	mat-row 
			  	*matRowDef="let element; columns: columnsToDisplay;"
		      class="example-element-row"
		      [class.example-expanded-row]="expandedElement === element"
		      (click)="selectProject(element)"
		    >
			  </tr>
			  <tr mat-row *matRowDef="let row; columns: ['expandedDetail']" class="example-detail-row"></tr>
			</table>

		</ng-container>
		<ng-template #loadingTemplate>
			<app-loader message="Chargement en cours"></app-loader>
		</ng-template>
	</mat-card-content>
</mat-card>