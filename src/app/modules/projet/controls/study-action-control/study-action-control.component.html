<mat-form-field>
	<mat-label>
		<mat-spinner 
			*ngIf="loading"
			diameter="20"
			strokeWidth="2"
		>
		</mat-spinner>
		{{ getText(displayAll ? 'Toutes les ${element}s' : 'Mes ${element}s') }}
	</mat-label>
	<button 
		*ngIf="!loading"
		mat-icon-button 
		matPrefix 
		[matTooltip]="getText(displayAll ? 'Afficher mes ${element}s' : 'Afficher toutes les ${element}s')"
		(click)="displayAll = !displayAll"
	>
    <mat-icon>{{ displayAll ? 'groups' : 'person_outline' }}</mat-icon>
  </button>
  <input 
	  type="text" 
	  [placeholder]="getText('Rechercher et selectionner une ${element}')" 
	  matInput 
	  #autocompleteTrigger
	  [required]="required" 
	  [formControl]="inputTerm" 
	  [matAutocomplete]="auto"
	  (click)="onClick($event)"
	>
  <mat-autocomplete 
  	#auto="matAutocomplete"
  	[displayWith]="displayFn.bind(this)"
  	(optionSelected)="onSelectOption($event.option.value)"
  >
  	<!-- Affichage des études avec selection des actions -->
		<ng-container *ngFor="let study of (displayStudies | async)|sortBy:'asc':'label'">
			<ng-container *ngIf="selectStudySwitcher || study.availableForAll; else optGroupTemplate">
			  <mat-option 
			  	[class.mat-selected] = "studyForm.value === study['@id']"
			  	[value]="{'study': study['@id'], action: null}"
			  >
			    <small><span style="color: #999;">{{ study.code }} - </span> {{ study.label }}</small>
			  </mat-option>
			</ng-container>
			<ng-template #optGroupTemplate>
				<mat-optgroup style="font-weight: normal;">
					<span class="study-code">{{ study.code }} - </span> <span class="study-label">{{ study.label }}</span>
			    <mat-option 
			    	*ngFor="let action of study.actions" 
			    	[class.mat-selected] = "actionForm.value === action['@id']"
			    	[value]="{'study': study['@id'], action: action['@id']}"
			    >
			      <small>{{ action.label }}</small>
			    </mat-option>
			  </mat-optgroup>
			  <mat-divider></mat-divider>
			</ng-template>

		</ng-container>
  </mat-autocomplete>
  <mat-slide-toggle
  	*ngIf="!onlyStudy"
		matSuffix 
		color="primary"
		matTooltip="Forcer la selection d'une étude"
		[checked]="selectStudySwitcher"
		(change)="onChangeStudySwitcher($event.checked)"
  >Selection d'une étude</mat-slide-toggle>
</mat-form-field>

<ng-template let-study="study" #studyOptionTemplate>  

</ng-template>